import {
  getIntersection,
  reformatCoordinates,
  retrieveNewMapElements,
} from '~/helpers/CoordinatesHelper.tsx';

jest.mock('~/helpers/API/MapboxAPI.tsx', () => ({
  getIsochronesCoordinatesForCylingOrWalking: jest.fn(
    () => mockIsochroneCoordinatesForWalking,
  ),
}));

jest.mock('~/helpers/API/BarsApi.tsx', () => ({
    getBarsFromApi: jest.fn(
        () => mockBarsInPolygon,
    ),
}));

test('Should retrieve new markers when intersection exist and bars exist in intersection', async () => {
  const params = paramsIntersectingForWalking;
  const newMapElements = await retrieveNewMapElements(
    params.locations,
    params.travelTime,
    params.meanOfTransport,
  );

  expect(newMapElements.newMarkers.length).toBeGreaterThan(0);
});

test('intersection of multiPolygon should not be null', () => {
  expect(getIntersection(isochronesCoordinates)).not.toBeNull();
});

test('reformat Api response', () => {
  expect(reformatCoordinates(apiReturn)).toStrictEqual(reformattedApiResponse);
});

const isochronesCoordinates = [
  {
    coordinates: [
      [
        [
          [-122.520217, 45.535693],
          [-122.64038, 45.553967],
          [-122.720031, 45.526554],
          [-122.669906, 45.507309],
          [-122.723464, 45.446643],
          [-122.532577, 45.408574],
          [-122.487258, 45.477466],
          [-122.520217, 45.535693],
        ],
      ],
    ],
    reformattedCoordinates: ['...'],
  },
  {
    coordinates: [
      [
        [
          [-122.801742, 45.48565],
          [-122.801742, 45.60491],
          [-122.584762, 45.60491],
          [-122.584762, 45.48565],
          [-122.801742, 45.48565],
        ],
      ],
    ],
    reformattedCoordinates: ['...'],
  },
];

const apiReturn = [
  [
    [
      [2.3043119815, 48.8281774604],
      [2.8, 48.9],
    ],
  ],
];

const reformattedApiResponse = [
  [
    [
      {
        longitude: 2.3043119815,
        latitude: 48.8281774604,
      },
      {
        longitude: 2.8,
        latitude: 48.9,
      },
    ],
  ],
];

const paramsIntersectingForWalking = {
  locations: [
    {
      GPSPosition: {
        latitude: 48.891213,
        longitude: 2.324828,
      },
      options: [],
      searchValue: '20 Rue Davy 75017 Paris',
    },
    {
      GPSPosition: {
        latitude: 48.883409,
        longitude: 2.323601,
      },
      options: [],
      searchValue: '6 Rue des Batignolles 75017 Paris',
    },
  ],
  meanOfTransport: 'walking',
  travelTime: 30,
};

const mockIsochroneCoordinatesForWalking = [
  {
    coordinates: [
      [
        [2.333828, 48.913248],
        [2.332102, 48.912939],
        [2.330828, 48.911005],
        [2.328828, 48.912533],
        [2.327828, 48.91264],
        [2.327013, 48.912028],
        [2.325828, 48.912799],
        [2.324828, 48.91275],
        [2.323552, 48.911213],
        [2.323649, 48.909213],
        [2.323186, 48.908855],
        [2.320828, 48.909642],
        [2.319217, 48.908824],
        [2.317828, 48.909116],
        [2.316424, 48.908617],
        [2.314828, 48.907444],
        [2.313359, 48.907744],
        [2.312828, 48.908495],
        [2.312057, 48.906984],
        [2.310828, 48.905982],
        [2.309383, 48.906768],
        [2.308828, 48.907587],
        [2.307828, 48.906709],
        [2.306828, 48.906778],
        [2.305828, 48.906031],
        [2.304828, 48.907186],
        [2.302828, 48.907324],
        [2.300828, 48.906916],
        [2.298602, 48.904439],
        [2.299111, 48.903213],
        [2.297899, 48.902213],
        [2.298487, 48.901213],
        [2.297392, 48.900213],
        [2.297828, 48.899761],
        [2.30053, 48.899915],
        [2.301956, 48.899213],
        [2.299828, 48.898476],
        [2.297828, 48.898832],
        [2.296965, 48.898213],
        [2.296395, 48.896213],
        [2.296646, 48.890395],
        [2.295402, 48.888213],
        [2.296101, 48.887213],
        [2.294235, 48.885213],
        [2.294828, 48.884037],
        [2.296468, 48.883213],
        [2.297068, 48.880453],
        [2.298863, 48.879213],
        [2.298593, 48.878213],
        [2.300828, 48.876929],
        [2.301828, 48.876504],
        [2.302828, 48.876699],
        [2.304557, 48.875942],
        [2.305936, 48.876321],
        [2.306828, 48.875399],
        [2.307828, 48.875704],
        [2.312828, 48.874307],
        [2.313828, 48.874659],
        [2.315828, 48.872671],
        [2.31708, 48.873465],
        [2.318826, 48.872211],
        [2.325828, 48.869585],
        [2.329828, 48.870748],
        [2.332828, 48.869933],
        [2.334828, 48.870083],
        [2.335537, 48.871213],
        [2.336742, 48.871299],
        [2.337631, 48.872213],
        [2.337217, 48.873213],
        [2.342308, 48.874213],
        [2.343723, 48.875213],
        [2.344279, 48.876213],
        [2.343604, 48.876989],
        [2.343759, 48.878282],
        [2.344828, 48.877353],
        [2.346659, 48.878213],
        [2.348828, 48.880126],
        [2.349828, 48.880362],
        [2.350617, 48.881213],
        [2.351286, 48.883755],
        [2.352332, 48.884213],
        [2.35263, 48.885411],
        [2.356024, 48.888017],
        [2.356046, 48.889213],
        [2.357134, 48.890213],
        [2.354651, 48.891036],
        [2.354374, 48.893213],
        [2.355185, 48.893856],
        [2.355262, 48.894647],
        [2.353435, 48.896213],
        [2.353602, 48.897439],
        [2.355519, 48.898213],
        [2.353828, 48.898803],
        [2.352828, 48.900123],
        [2.350828, 48.899686],
        [2.348669, 48.900054],
        [2.348828, 48.900754],
        [2.349679, 48.901213],
        [2.347218, 48.904213],
        [2.345765, 48.904276],
        [2.34618, 48.903213],
        [2.344721, 48.902106],
        [2.344735, 48.905213],
        [2.343828, 48.905782],
        [2.343048, 48.904993],
        [2.34066, 48.905213],
        [2.340614, 48.906427],
        [2.34207, 48.906971],
        [2.342113, 48.908213],
        [2.340405, 48.90879],
        [2.337504, 48.910889],
        [2.335774, 48.911159],
        [2.334828, 48.913205],
        [2.333828, 48.913248],
      ],
    ],
    reformattedCoordinates: [
      [
        { latitude: 48.913248, longitude: 2.333828 },
        { latitude: 48.912939, longitude: 2.332102 },
        { latitude: 48.911005, longitude: 2.330828 },
        { latitude: 48.912533, longitude: 2.328828 },
        { latitude: 48.91264, longitude: 2.327828 },
        { latitude: 48.912028, longitude: 2.327013 },
        { latitude: 48.912799, longitude: 2.325828 },
        { latitude: 48.91275, longitude: 2.324828 },
        { latitude: 48.911213, longitude: 2.323552 },
        { latitude: 48.909213, longitude: 2.323649 },
        { latitude: 48.908855, longitude: 2.323186 },
        { latitude: 48.909642, longitude: 2.320828 },
        { latitude: 48.908824, longitude: 2.319217 },
        { latitude: 48.909116, longitude: 2.317828 },
        { latitude: 48.908617, longitude: 2.316424 },
        { latitude: 48.907444, longitude: 2.314828 },
        { latitude: 48.907744, longitude: 2.313359 },
        { latitude: 48.908495, longitude: 2.312828 },
        { latitude: 48.906984, longitude: 2.312057 },
        { latitude: 48.905982, longitude: 2.310828 },
        { latitude: 48.906768, longitude: 2.309383 },
        { latitude: 48.907587, longitude: 2.308828 },
        { latitude: 48.906709, longitude: 2.307828 },
        { latitude: 48.906778, longitude: 2.306828 },
        { latitude: 48.906031, longitude: 2.305828 },
        { latitude: 48.907186, longitude: 2.304828 },
        { latitude: 48.907324, longitude: 2.302828 },
        { latitude: 48.906916, longitude: 2.300828 },
        { latitude: 48.904439, longitude: 2.298602 },
        { latitude: 48.903213, longitude: 2.299111 },
        { latitude: 48.902213, longitude: 2.297899 },
        { latitude: 48.901213, longitude: 2.298487 },
        { latitude: 48.900213, longitude: 2.297392 },
        { latitude: 48.899761, longitude: 2.297828 },
        { latitude: 48.899915, longitude: 2.30053 },
        { latitude: 48.899213, longitude: 2.301956 },
        { latitude: 48.898476, longitude: 2.299828 },
        { latitude: 48.898832, longitude: 2.297828 },
        { latitude: 48.898213, longitude: 2.296965 },
        { latitude: 48.896213, longitude: 2.296395 },
        { latitude: 48.890395, longitude: 2.296646 },
        { latitude: 48.888213, longitude: 2.295402 },
        { latitude: 48.887213, longitude: 2.296101 },
        { latitude: 48.885213, longitude: 2.294235 },
        { latitude: 48.884037, longitude: 2.294828 },
        { latitude: 48.883213, longitude: 2.296468 },
        { latitude: 48.880453, longitude: 2.297068 },
        { latitude: 48.879213, longitude: 2.298863 },
        { latitude: 48.878213, longitude: 2.298593 },
        { latitude: 48.876929, longitude: 2.300828 },
        { latitude: 48.876504, longitude: 2.301828 },
        { latitude: 48.876699, longitude: 2.302828 },
        { latitude: 48.875942, longitude: 2.304557 },
        { latitude: 48.876321, longitude: 2.305936 },
        { latitude: 48.875399, longitude: 2.306828 },
        { latitude: 48.875704, longitude: 2.307828 },
        { latitude: 48.874307, longitude: 2.312828 },
        { latitude: 48.874659, longitude: 2.313828 },
        { latitude: 48.872671, longitude: 2.315828 },
        { latitude: 48.873465, longitude: 2.31708 },
        { latitude: 48.872211, longitude: 2.318826 },
        { latitude: 48.869585, longitude: 2.325828 },
        { latitude: 48.870748, longitude: 2.329828 },
        { latitude: 48.869933, longitude: 2.332828 },
        { latitude: 48.870083, longitude: 2.334828 },
        { latitude: 48.871213, longitude: 2.335537 },
        { latitude: 48.871299, longitude: 2.336742 },
        { latitude: 48.872213, longitude: 2.337631 },
        { latitude: 48.873213, longitude: 2.337217 },
        { latitude: 48.874213, longitude: 2.342308 },
        { latitude: 48.875213, longitude: 2.343723 },
        { latitude: 48.876213, longitude: 2.344279 },
        { latitude: 48.876989, longitude: 2.343604 },
        { latitude: 48.878282, longitude: 2.343759 },
        { latitude: 48.877353, longitude: 2.344828 },
        { latitude: 48.878213, longitude: 2.346659 },
        { latitude: 48.880126, longitude: 2.348828 },
        { latitude: 48.880362, longitude: 2.349828 },
        { latitude: 48.881213, longitude: 2.350617 },
        { latitude: 48.883755, longitude: 2.351286 },
        { latitude: 48.884213, longitude: 2.352332 },
        { latitude: 48.885411, longitude: 2.35263 },
        { latitude: 48.888017, longitude: 2.356024 },
        { latitude: 48.889213, longitude: 2.356046 },
        { latitude: 48.890213, longitude: 2.357134 },
        { latitude: 48.891036, longitude: 2.354651 },
        { latitude: 48.893213, longitude: 2.354374 },
        { latitude: 48.893856, longitude: 2.355185 },
        { latitude: 48.894647, longitude: 2.355262 },
        { latitude: 48.896213, longitude: 2.353435 },
        { latitude: 48.897439, longitude: 2.353602 },
        { latitude: 48.898213, longitude: 2.355519 },
        { latitude: 48.898803, longitude: 2.353828 },
        { latitude: 48.900123, longitude: 2.352828 },
        { latitude: 48.899686, longitude: 2.350828 },
        { latitude: 48.900054, longitude: 2.348669 },
        { latitude: 48.900754, longitude: 2.348828 },
        { latitude: 48.901213, longitude: 2.349679 },
        { latitude: 48.904213, longitude: 2.347218 },
        { latitude: 48.904276, longitude: 2.345765 },
        { latitude: 48.903213, longitude: 2.34618 },
        { latitude: 48.902106, longitude: 2.344721 },
        { latitude: 48.905213, longitude: 2.344735 },
        { latitude: 48.905782, longitude: 2.343828 },
        { latitude: 48.904993, longitude: 2.343048 },
        { latitude: 48.905213, longitude: 2.34066 },
        { latitude: 48.906427, longitude: 2.340614 },
        { latitude: 48.906971, longitude: 2.34207 },
        { latitude: 48.908213, longitude: 2.342113 },
        { latitude: 48.90879, longitude: 2.340405 },
        { latitude: 48.910889, longitude: 2.337504 },
        { latitude: 48.911159, longitude: 2.335774 },
        { latitude: 48.913205, longitude: 2.334828 },
        { latitude: 48.913248, longitude: 2.333828 },
      ],
    ],
  },
  {
    coordinates: [
      [
        [2.331601, 48.905623],
        [2.328601, 48.905345],
        [2.324322, 48.902688],
        [2.323601, 48.901545],
        [2.322601, 48.902556],
        [2.321601, 48.90231],
        [2.320601, 48.900776],
        [2.319601, 48.901008],
        [2.317305, 48.900705],
        [2.316762, 48.900409],
        [2.316786, 48.899224],
        [2.315338, 48.899409],
        [2.315268, 48.900409],
        [2.314601, 48.900709],
        [2.307601, 48.901508],
        [2.307054, 48.900956],
        [2.305601, 48.900732],
        [2.304797, 48.899409],
        [2.303739, 48.894271],
        [2.301472, 48.89428],
        [2.301111, 48.894919],
        [2.298899, 48.895707],
        [2.298601, 48.896267],
        [2.296601, 48.896181],
        [2.296151, 48.895409],
        [2.296722, 48.891409],
        [2.295466, 48.890544],
        [2.295124, 48.889409],
        [2.293316, 48.888694],
        [2.292961, 48.887049],
        [2.291296, 48.885409],
        [2.292123, 48.884409],
        [2.292208, 48.880409],
        [2.290951, 48.879409],
        [2.292399, 48.877207],
        [2.295198, 48.875409],
        [2.295601, 48.873107],
        [2.299601, 48.87103],
        [2.300601, 48.869151],
        [2.303601, 48.869727],
        [2.306601, 48.868421],
        [2.307601, 48.868555],
        [2.308026, 48.867834],
        [2.310601, 48.866386],
        [2.311601, 48.866809],
        [2.312601, 48.866687],
        [2.313601, 48.864826],
        [2.314601, 48.865676],
        [2.316869, 48.865677],
        [2.319079, 48.863887],
        [2.319601, 48.862723],
        [2.322601, 48.863296],
        [2.324601, 48.863204],
        [2.325742, 48.864409],
        [2.327601, 48.864849],
        [2.328601, 48.864314],
        [2.334735, 48.864275],
        [2.342347, 48.868663],
        [2.343601, 48.868632],
        [2.346601, 48.870818],
        [2.348839, 48.871409],
        [2.349267, 48.872743],
        [2.350545, 48.873409],
        [2.35047, 48.874409],
        [2.352601, 48.875724],
        [2.355601, 48.876746],
        [2.354973, 48.878409],
        [2.355958, 48.879409],
        [2.355215, 48.880023],
        [2.35511, 48.882409],
        [2.35702, 48.884409],
        [2.356385, 48.885409],
        [2.354601, 48.88547],
        [2.352758, 48.887409],
        [2.351819, 48.887627],
        [2.350172, 48.88898],
        [2.35088, 48.891409],
        [2.35041, 48.892218],
        [2.34848, 48.893409],
        [2.346978, 48.895786],
        [2.346275, 48.898083],
        [2.344601, 48.899423],
        [2.343601, 48.899137],
        [2.342601, 48.899794],
        [2.341601, 48.899691],
        [2.340601, 48.90061],
        [2.337398, 48.900206],
        [2.336094, 48.901902],
        [2.333072, 48.903409],
        [2.331601, 48.905623],
      ],
    ],
    reformattedCoordinates: [
      [
        { latitude: 48.905623, longitude: 2.331601 },
        { latitude: 48.905345, longitude: 2.328601 },
        { latitude: 48.902688, longitude: 2.324322 },
        { latitude: 48.901545, longitude: 2.323601 },
        { latitude: 48.902556, longitude: 2.322601 },
        { latitude: 48.90231, longitude: 2.321601 },
        { latitude: 48.900776, longitude: 2.320601 },
        { latitude: 48.901008, longitude: 2.319601 },
        { latitude: 48.900705, longitude: 2.317305 },
        { latitude: 48.900409, longitude: 2.316762 },
        { latitude: 48.899224, longitude: 2.316786 },
        { latitude: 48.899409, longitude: 2.315338 },
        { latitude: 48.900409, longitude: 2.315268 },
        { latitude: 48.900709, longitude: 2.314601 },
        { latitude: 48.901508, longitude: 2.307601 },
        { latitude: 48.900956, longitude: 2.307054 },
        { latitude: 48.900732, longitude: 2.305601 },
        { latitude: 48.899409, longitude: 2.304797 },
        { latitude: 48.894271, longitude: 2.303739 },
        { latitude: 48.89428, longitude: 2.301472 },
        { latitude: 48.894919, longitude: 2.301111 },
        { latitude: 48.895707, longitude: 2.298899 },
        { latitude: 48.896267, longitude: 2.298601 },
        { latitude: 48.896181, longitude: 2.296601 },
        { latitude: 48.895409, longitude: 2.296151 },
        { latitude: 48.891409, longitude: 2.296722 },
        { latitude: 48.890544, longitude: 2.295466 },
        { latitude: 48.889409, longitude: 2.295124 },
        { latitude: 48.888694, longitude: 2.293316 },
        { latitude: 48.887049, longitude: 2.292961 },
        { latitude: 48.885409, longitude: 2.291296 },
        { latitude: 48.884409, longitude: 2.292123 },
        { latitude: 48.880409, longitude: 2.292208 },
        { latitude: 48.879409, longitude: 2.290951 },
        { latitude: 48.877207, longitude: 2.292399 },
        { latitude: 48.875409, longitude: 2.295198 },
        { latitude: 48.873107, longitude: 2.295601 },
        { latitude: 48.87103, longitude: 2.299601 },
        { latitude: 48.869151, longitude: 2.300601 },
        { latitude: 48.869727, longitude: 2.303601 },
        { latitude: 48.868421, longitude: 2.306601 },
        { latitude: 48.868555, longitude: 2.307601 },
        { latitude: 48.867834, longitude: 2.308026 },
        { latitude: 48.866386, longitude: 2.310601 },
        { latitude: 48.866809, longitude: 2.311601 },
        { latitude: 48.866687, longitude: 2.312601 },
        { latitude: 48.864826, longitude: 2.313601 },
        { latitude: 48.865676, longitude: 2.314601 },
        { latitude: 48.865677, longitude: 2.316869 },
        { latitude: 48.863887, longitude: 2.319079 },
        { latitude: 48.862723, longitude: 2.319601 },
        { latitude: 48.863296, longitude: 2.322601 },
        { latitude: 48.863204, longitude: 2.324601 },
        { latitude: 48.864409, longitude: 2.325742 },
        { latitude: 48.864849, longitude: 2.327601 },
        { latitude: 48.864314, longitude: 2.328601 },
        { latitude: 48.864275, longitude: 2.334735 },
        { latitude: 48.868663, longitude: 2.342347 },
        { latitude: 48.868632, longitude: 2.343601 },
        { latitude: 48.870818, longitude: 2.346601 },
        { latitude: 48.871409, longitude: 2.348839 },
        { latitude: 48.872743, longitude: 2.349267 },
        { latitude: 48.873409, longitude: 2.350545 },
        { latitude: 48.874409, longitude: 2.35047 },
        { latitude: 48.875724, longitude: 2.352601 },
        { latitude: 48.876746, longitude: 2.355601 },
        { latitude: 48.878409, longitude: 2.354973 },
        { latitude: 48.879409, longitude: 2.355958 },
        { latitude: 48.880023, longitude: 2.355215 },
        { latitude: 48.882409, longitude: 2.35511 },
        { latitude: 48.884409, longitude: 2.35702 },
        { latitude: 48.885409, longitude: 2.356385 },
        { latitude: 48.88547, longitude: 2.354601 },
        { latitude: 48.887409, longitude: 2.352758 },
        { latitude: 48.887627, longitude: 2.351819 },
        { latitude: 48.88898, longitude: 2.350172 },
        { latitude: 48.891409, longitude: 2.35088 },
        { latitude: 48.892218, longitude: 2.35041 },
        { latitude: 48.893409, longitude: 2.34848 },
        { latitude: 48.895786, longitude: 2.346978 },
        { latitude: 48.898083, longitude: 2.346275 },
        { latitude: 48.899423, longitude: 2.344601 },
        { latitude: 48.899137, longitude: 2.343601 },
        { latitude: 48.899794, longitude: 2.342601 },
        { latitude: 48.899691, longitude: 2.341601 },
        { latitude: 48.90061, longitude: 2.340601 },
        { latitude: 48.900206, longitude: 2.337398 },
        { latitude: 48.901902, longitude: 2.336094 },
        { latitude: 48.903409, longitude: 2.333072 },
        { latitude: 48.905623, longitude: 2.331601 },
      ],
    ],
  },
];

const mockBarsInPolygon = [
  { coordinates: [2.3215, 48.885707], otherAttributes: 'whatever' },
  {
    coordinates: [2.329007, 48.890355],
    otherAttributes: 'whatever',
  },
];
